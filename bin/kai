#!/usr/bin/env ruby

require 'optparse'
require_relative '../program'

options = {}
OptionParser.new do |opts|
  opts.banner = "Usage: kai [options] path [arguments]\n" \
                "       kai [options] -e \"(print (+ 2 2))\" [arguments]"

  opts.on('-d', '--debug', 'Output debugging information') do
    options[:debug] = true
  end

  opts.on('-e "(print (+ 2 2))"', 'Execute script passed as argument') do |script|
    options[:script] = script
  end

  opts.on('-h', '--help', 'Print this help') do
    puts opts
    exit
  end
end.parse!

program = if options[:script]
  Program.new(options[:script], args: ARGV)
else
  Program.new(File.read(ARGV.shift), args: ARGV)
end

program.run(debug: options[:debug] ? 2 : 0)
